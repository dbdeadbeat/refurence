{% import "profiles/_content.html" as content with context %}
{% import "profiles/_neo.html" as neo with context %}
{% extends "base.html" %}

{% block title %}
{{ profile.username }}
{% endblock %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/blueimp-gallery.min.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/neo.css') }}">
{{ neo.render_header_style(profile) }}
{% endblock %}

{% block topbar %}
{% endblock %}

{% block body_attribs %}
{% endblock %}


{% block navbar %}
<nav class="navbar navbar-default" id="neo-nav">
    <div class="container-fluid" id="neo-nav-container">
        <!-- Nav links -->
        <div class="collapse navbar-collapse" id="neonavbar">

            <ul class="nav navbar-nav navbar-right">
                {% if not dropbox.is_authenticated %}
                <li> <a href="{{dropbox.login_url}}">login with dropbox</a> </li>
                {% else %}
                <li> <a href="{{ url_for('users.controlpanel')}}">{{dropbox.account_info['email']}}</a></li>
                <li><a href="{{dropbox.logout_url}}">logout</a> </li>
                {% endif %}

            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>
{% endblock %}

{% block content %}
<div class="container container-fluid">
		<div class="col-md-1 sidebar">
				<p style="text-align: center">
				<div class="col-xs-12">
						<div id="avatar">
								<img id="{{AVATAR_IMG}}" class="img-responsive img-circle avatar-img centered" src="{{ profile.header.avatar_url }}">
						</div>
				</div>
				{% if is_me %}
				<div class="col-xs-12 hr fill-low-opacity"></div>
				<div class="col-xs-12">
						<a class="btn btn-dark btn-lg btn-sidebar" type="button" href="{{ url_for('profiles.edit', slug=profile.username) }}">
								<span class="glyphicon glyphicon-edit" aria=hidden="true"></span>
								Edit Profile
						</a>
				</div>
				{% endif %}
				<div class="col-xs-12 hr fill-low-opacity"></div>
				{% if profile.description.tables.keys()|length > 0 %}
				<div class="col-xs-12">
						<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
								{% for i in range(0, profile.description.tables.keys()|length) %}
								<div class="panel description-content" id="description-content-{{i}}">
										<div class="panel-heading btn-sidebar" role="tab" id="heading{{i}}">
												<a class="panel-data-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapse{{i}}" aria-expanded="true" aria-controls="collapse{{i}}">
														<h4 class="panel-title">{{ profile.description.get_keys()[i] }}</h4>
												</a>
										</div>
								</div>
								{% endfor %}
						</div>
				</div>
				{% endif %}
				</p>
		</div>
		<div class="col-md-11 col-md-offset-1 content">
				<div class="col-xs-12" id="header">
						<h1 id="{{HEADER_TITLE}}" class="text-editable"
								contenteditable="{{editable}}">{{ profile.header.title }}</h1>
						<h4 id="{{HEADER_BODY}}" class="text-editable"
								contenteditable="{{editable}}">{{ profile.header.body }}</h4>
				</div>
				{% for i in range(0, profile.description.tables.keys()|length) %}
				<div id="collapse{{i}}" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading{{i}}">
						{% if profile.description.get_tables()[i].get_image_links()[0] %}
						<div class="panel-body" style="background: url({{profile.description.get_tables()[i].get_image_links()[0]}}) 50% 50% / cover no-repeat; min-height: 500px;">
								{% else %}
								<div class="panel-body">
										{% endif %}
										<div class="col-xs-12 panel-body-text" 
												{% if not profile.description.get_tables()[i].get_text() %}
												style="background-color: transparent;"
												{% endif %}
												>
												<p class="text-editable">{{ profile.description.get_tables()[i].get_text() }}</p>
										</div>
								</div>
						</div>
						{% endfor %}
						{{ neo.render_gallery(profile.gallery) }}
				</div>
		</div>
</div> <!-- END container -->

<!-- blueimp -->
<div id="blueimp-gallery" class="blueimp-gallery">
  <!-- The container for the modal slides -->
  <div class="slides"></div>
  <!-- Controls for the borderless lightbox -->
  <h3 class="title"></h3>
  <a class="prev">‹</a>
  <a class="next">›</a>
  <a class="close">×</a>
  <a class="play-pause"></a>
  <ol class="indicator"></ol>
  <!-- The modal dialog, which will be used to wrap the lightbox content -->
  <div class="modal fade">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" aria-hidden="true">&times;</button>
          <h4 class="modal-title"></h4>
        </div>
        <div class="modal-body next"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default pull-left prev">
            <i class="glyphicon glyphicon-chevron-left"></i>
            Previous
          </button>
          <button type="button" class="btn btn-primary next">
            Next
            <i class="glyphicon glyphicon-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div> <!-- END blueimp -->

{% endblock %} <!-- END block content -->

{% block scripts %}
{{ super() }}
<script src="https://cdnjs.cloudflare.com/ajax/libs/masonry/3.3.0/masonry.pkgd.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/webfont/1.5.6/webfont.js"></script>

<script>
WebFont.load({
google: {
families: [
{% for key in profile.fonts.keys() %}
{% if profile.fonts[key]|length > 0 %}
'{{ profile.fonts[key] }}',
{% endif %}
{% endfor %}
]
}
});
</script>
<script src={{ url_for('static', filename='js/blueimp-gallery.min.js') }} type="text/javascript"></script>
<script src={{ url_for('static', filename='js/imagesloaded.pkgd.min.js') }} type="text/javascript"></script>
<script src={{ url_for('static', filename='js/detail.js') }} type="text/javascript"></script>

<script>
$(function() {
				$('.panel-data-toggle').on('click', function() {
						$(this).parent().toggleClass("clicked");
						})
				});
</script>
{% endblock %}
